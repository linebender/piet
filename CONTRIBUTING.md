## snapshot testing

Piet uses 'snapshot testing' to verify that changes do not unexpectedly modify
behaviour. During CI, sample pictures are generated by the various `picture_{}`
files in `piet`'s [`samples`] module, and the results are compared against
previously generated versions.

The previously generated versions are stored in a separate repository,
[`piet-snapshots`]; these are saved per-platform, because platform behaviour may
differ (especially around fonts).

### updating the reference snapshots

If your patch changes the behaviour of these snapshots, they will need to be
regenerated. The easiest way to do this is to open a draft PR; this will trigger
a 'snapshots' CI run. On failure, this will upload an artifact containing the
generated snapshots (see [persisting workflow data using artifacts] for
information on artifacts). You can download these, copy them into the snapshots
submodule, push your changes, and then commit the new submodule revision as part
of your PR.

[`samples`]: https://github.com/linebender/piet/tree/master/piet/src/samples
[`piet-snapshots`]: https://github.com/linebender/piet-snapshots
[persisting workflow data using artifacts]: https://docs.github.com/en/actions/configuring-and-managing-workflows/persisting-workflow-data-using-artifacts
